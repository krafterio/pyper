<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="pappers_name_form_view" model="ir.ui.view">
        <field name="name">pappers.name.edit.form</field>
        <field name="model">pappers.name.form</field>
        <field name="arch" type="xml">
            <form>
                <field name="is_api_key_set" invisible="True"/>
                <div invisible="is_api_key_set">
                    <div class="alert alert-warning" role="alert">
                        Warning: The Pappers API key is not set, so the information will not be complete.
                    </div>
                </div>
                <group invisible="not context.get('search_more') and identified_partner_id != False">
                    <div class="d-flex flex-row align-items-start" colspan="2">
                        <field
                            name="name"
                            placeholder="Search a company name"
                            default_focus="1"
                            class="flew-grow-1"
                            readonly="not context.get('search_more') and results"
                        />

                        <button
                            name="action_pappers_new_api_call"
                            type="object"
                            string="Reset search"
                            class="btn btn-danger text-nowrap ms-2"
                            data-hotkey="g"
                            invisible="(not context.get('search_more') and identified_partner_id != False) or not results"
                        />
                    </div>
                    <field name="identified_partner_id" invisible="True"/>
                </group>

                <field
                    name="results"
                    nolabel="True"
                    readonly="True"
                    invisible="not results"
                >
                    <tree>
                        <field name="name"/>
                        <field name="siret" widget="CopyClipboardChar"/>
                        <field name="zip" optional="hide"/>
                        <field name="city"/>
                        <field name="creation_date"/>

                        <button
                            name="action_create_company_siret"
                            type="object"
                            class="btn btn-primary"
                            icon="fa-plus"
                            title="Create company"
                            invisible="parent.identified_partner_id != False"
                        />

                        <button
                            name="action_update_company_pappers"
                            type="object"
                            class="btn btn-primary"
                            title="Download information"
                            icon="fa-download"
                            context="{'pappers_siret': siret, 'pappers_identified_partner': parent.identified_partner_id}"
                            invisible="parent.identified_partner_id == False"
                        />
                    </tree>
                </field>

                <div class="alert alert-info" invisible="results">
                    <p class="mb-0">Search a company in the top area and the matching results will appear here.</p>
                </div>

                <footer>
                    <button
                        name="action_pappers_api_call"
                        type="object"
                        string="Get companies"
                        class="btn-primary o_sale_warranty_configurator_add"
                        data-hotkey="g"
                        invisible="not context.get('search_more') and (identified_partner_id != False or results)"
                    />

                    <button
                        string="Close"
                        class="btn-secondary"
                        data-hotkey="z"
                        special="cancel"
                    />
                </footer>
            </form>
        </field>
    </record>
</odoo>
