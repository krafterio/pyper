<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="pyper_dashboard.DashboardView">
        <div class="pyper_dashboard d-flex flex-column" t-att-class="{'editable': this.canEdit}">
            <t t-call="pyper_dashboard.DashboardHeader"/>

            <t t-if="dashboard.isEmpty">
                <t t-call="pyper_dashboard.DashboardNoContent"/>
            </t>
            <t t-else="">
                <t t-call="pyper_dashboard.DashboardContent"/>
            </t>
        </div>
    </t>

    <t t-name="pyper_dashboard.DashboardHeader">
        <div class="pyper_dashboard--header">
            <div>
                <h2 t-if="dashboard.title" t-out="dashboard.title"/>
                <h2 t-else="">Dashboard</h2>
            </div>

            <div class="flex-grow-1 ps-4" t-if="dashboard.useSwitcher and boards.length > 1">
                <Dropdown showCaret="true" togglerClass="'btn btn-secondary p-2'">
                    <t t-set-slot="toggler">
                        <t t-out="selectedBoard?.name"/>
                    </t>

                    <t t-foreach="boards" t-as="board" t-key="board.id">
                        <DropdownItem onSelected="() => this.selectBoard(board)">
                            <t t-out="board.name"/>
                        </DropdownItem>
                    </t>
                </Dropdown>
            </div>

            <div>
                <Dropdown
                    togglerClass="'btn btn-outline-default py-1'"
                    t-if="this.canEdit and (!dashboard?.isEmpty or this.canAdmin)"
                >
                    <t t-set-slot="toggler">
                        <i class="fa fa-fw fa-ellipsis-v" aria-label="Section settings" role="img" title="Section settings"/>
                    </t>

                    <DropdownItem onSelected="() => this.addSection()" t-if="!dashboard?.isEmpty">
                        <i class="oi-fw oi-fw me-1 fa fa-plus"></i>
                        Add a section
                    </DropdownItem>

                    <DropdownItem onSelected="() => this.actionSettings()" t-if="this.canAdmin">
                        <i class="oi-fw oi-fw me-1 fa fa-gear"></i>
                        Settings
                    </DropdownItem>
                </Dropdown>
            </div>
        </div>
    </t>

    <t t-name="pyper_dashboard.DashboardContent">
        <div class="pyper_dashboard--container" t-ref="main">
            <t t-foreach="dashboard.sections" t-as="section" t-key="section_index">
                <DashboardSection
                    selectLayout="(layout, save) => this.selectLayout(section, layout, save, section_index)"
                    edit="(data) => this.editSection(section, data)"
                    remove="() => this.removeSection(section_index)"
                    title="section.title"
                    layout="section.layout"
                    layoutEditable="section.layoutEditable and this.canEdit"
                    attr="{'data-idx': section_index}"
                >
                    <t t-foreach="section.columns" t-as="column" t-key="column_index">
                        <DashboardColumn attr="{'data-idx': column_index}">
                            <t t-foreach="column.actions" t-as="action" t-key="selectedBoard?.id + '__' + action.id">
                                <DashboardAction
                                    toggle="() => this.toggleAction(action)"
                                    remove="() => this.removeAction(column, action)"
                                    title="action.title"
                                    actionId="action.actionId"
                                    viewMode="action.viewMode"
                                    context="action.context"
                                    domain="action.domain"
                                    foldable="this.canEdit"
                                    isFolded="action.isFolded"
                                    attr="{'data-idx': action_index}"
                                />
                            </t>
                        </DashboardColumn>
                    </t>
                </DashboardSection>
            </t>
        </div>
    </t>

    <t t-name="pyper_dashboard.DashboardNoContent">
        <div class="o_view_nocontent">
            <div class="o_nocontent_help">
                <p class="o_view_nocontent_neutral_face">
                  Dashboard is empty
                </p>

                <p>
                  To add your first graph into this dashboard, go to any
                  menu, switch to list or graph view, and click <i>"Add to
                  dashboard"</i> in the extended search options.
                </p>

                <p>
                  You can group and filter data before inserting into the
                  dashboard using the search options.
                </p>
            </div>
        </div>
    </t>

    <t t-name="pyper_dashboard.Arch">
        <dashboard
            t-att-string="title || undefined"
            t-att-switcher="useSwitcher ? undefined : 'False'"
        >
            <t t-foreach="sections" t-as="section" t-key="section_index">
                <section
                    t-att-string="section.title || undefined"
                    t-att-layout="section.layout || undefined"
                    t-att-layout_editable="section.layoutEditable ? undefined : 'False'"
                >
                    <column t-foreach="section.columns" t-as="column" t-key="column_index">
                        <t t-foreach="column.actions" t-as="action" t-key="action_index">
                            <action
                                t-att-name="action.actionId"
                                t-att-string="action.title"
                                t-att-view_mode="action.viewMode"
                                t-att-context="action.context"
                                t-att-domain="action.domain"
                                t-att-fold="action.isFolded ? 'True' : undefined"
                            />
                        </t>
                    </column>
                </section>
            </t>
        </dashboard>
    </t>
</templates>
