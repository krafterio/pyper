<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-inherit="mail.Message" t-inherit-mode="extension">
        <xpath expr="//div[hasclass('o-mail-Message-textContent')]/*[1]" position="replace">
            <t t-if="message.type === 'notification' or message.is_transient or message.trackingValues.length > 0" name="hasTrackingValue">
                <LinkPreviewList t-if="!state.isEditing and message.linkPreviewSquash" linkPreviews="message.linkPreviews" deletable="false"/>
                <div t-if="state.isEditing" class="o-mail-Message-textContent">
                    <div class="position-relative overflow-x-auto d-inline-block" t-att-class="{ 'w-100': state.isEditing }">
                        <div class="o-mail-Message-bubble rounded-bottom-3 position-absolute top-0 start-0 w-100 h-100" t-att-class="{
                            'border': state.isEditing and !message.is_note,
                            'bg-info-light border border-info opacity-25': !message.isSelfAuthored and !message.is_note and !message.isHighlightedFromMention,
                            'bg-success-light border border-success opacity-25': message.isSelfAuthored and !message.is_note and !message.isHighlightedFromMention,
                            'bg-warning-light border border-warning opacity-50': message.isHighlightedFromMention,
                            }" t-attf-class="{{ isAlignedRight ? 'rounded-start-3' : 'rounded-end-3' }}"/>
                        <div class="position-relative text-break o-mail-Message-body" t-att-class="{
                                    'p-1': message.is_note,
                                    'mb-0 py-2 px-3': !message.is_note,
                                    'align-self-start rounded-end-3 rounded-bottom-3': !state.isEditing and !message.is_note,
                                    'o-mail-Message-editable flex-grow-1': state.isEditing,
                                    }" t-ref="body">
                            <Composer t-if="state.isEditing" autofocus="true" composer="message.composer" messageComponent="constructor" onDiscardCallback.bind="exitEditMode" onPostCallback.bind="exitEditMode" mode="env.inChatter ? 'extended' : 'compact'" sidebar="false"/>
                        </div>
                    </div>
                </div>
                <div t-else="">
                    <div class="overflow-x-auto" t-if="message.type and message.type.includes('email')" t-ref="shadowBody"/>
                    <t t-elif="state.showTranslation" t-out="message.translationValue"/>
                    <t t-if="message.subtype_description">
                        <p class="mb-0">
                            <t t-out="props.messageSearch?.highlight(message.subtype_description) ?? message.subtype_description"/>
                        </p>
                    </t>
                    <t t-if="message.trackingValues.length">
                        <ul class="mb-0 ps-4">
                            <t name="trackingValues" t-foreach="message.trackingValues" t-as="trackingValue" t-key="trackingValue.id">
                                <li class="o-mail-Message-tracking mb-1" role="group">
                                    <span class="o-mail-Message-trackingOld me-1 px-1 text-muted fw-bold" t-esc="formatTrackingOrNone(trackingValue.fieldType, trackingValue.oldValue)"/>
                                    <i class="o-mail-Message-trackingSeparator fa fa-long-arrow-right mx-1 text-600"/>
                                    <span class="o-mail-Message-trackingNew me-1 fw-bold text-info" t-esc="formatTrackingOrNone(trackingValue.fieldType, trackingValue.newValue)"/>
                                    <span class="o-mail-Message-trackingField ms-1 fst-italic text-muted">(<t t-esc="trackingValue.changedField"/>)</span>
                                </li>
                            </t>
                        </ul>
                    </t>
                    <div t-if="message.body" class="o-mail-Message-body text-break mb-0 w-100" t-ref="body">
                        <t t-out="props.messageSearch?.highlight(message.body) ?? message.body"/>
                    </div>
                </div>
            </t>
        </xpath>
    </t>
</templates>

