<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="pyper_organization.SwitchOrganizationMenu">
        <Dropdown class="'o_switch_organization_menu'" position="'bottom-end'">
            <t t-set-slot="toggler">
                <div class="o_avatar o_user_avatar">
                    <span t-esc="organizationInitials"/>

                    <img
                        t-if="organizationLogo"
                        t-att-src="organizationLogo"
                        alt="Organization Logo"
                    />
                </div>
            </t>

            <DropdownItem t-if="Object.values(organizationService.allowedOrganizations).length > 1" class="'p-0 bg-white'">
                <div class="d-flex align-items-center">
                    <div
                        role="menuitemcheckbox"
                        t-att-aria-checked="isAllOrganizationsSelected ? 'true' : 'false'"
                        tabindex="0"
                        class="border-end toggle_organization"
                        t-att-class="{'border-primary': isAllOrganizationsSelected}"
                        t-on-click.stop="() => this.toggleAllOrganizations()"
                    >
                        <span class="btn border-0 p-2" t-att-class="isAllOrganizationsSelected ? 'btn-link text-primary' : 'disabled'">
                            <i class="fa fa-fw py-2" t-att-class="isAllOrganizationsSelected ? 'fa-check-square text-primary' : 'fa-square-o'"/>
                        </span>
                    </div>

                    <div class="o_switcher_organization_item--logo">
                        <img src="/pyper_organization/static/img/badge-18x18.svg" class="o_switcher_organization_menu--badge"/>
                    </div>

                    <div
                        role="button"
                        tabindex="0"
                        class="d-flex flex-grow-1 align-items-center py-0 ps-2 ms-1 me-2 all-organizationes-item"
                        title="Select All Organizations"
                        name="select_all_organizations"
                        t-on-click.stop="() => this.toggleAllOrganizations()"
                    >
                        <span>All Organizations</span>
                    </div>
                </div>
            </DropdownItem>

            <t t-foreach="Object.values(organizationService.allowedOrganizations)
                          .filter((c) => !c.parent_id)
                          .sort((c1, c2) => c1.sequence - c2.sequence)
                         "
               t-as="organization"
               t-key="organization.id"
            >
                <SwitchOrganizationItem organization="organization"/>
            </t>
        </Dropdown>
    </t>


    <t t-name="pyper_organization.SwitchOrganizationItem">
        <DropdownItem
            class="'p-0'"
            parentClosingMode="!isOrganizationAllowed ? 'none' : 'all'"
        >
            <div
                class="d-flex"
                t-att-class="{'disabled': !isOrganizationAllowed, 'alert-primary': isCurrent}"
                data-menu="organization"
                t-att-data-organization-id="props.organization.id"
            >
                <div
                    role="menuitemcheckbox"
                    t-att-aria-checked="isOrganizationSelected ? 'true' : 'false'"
                    t-att-aria-label="props.organization.name"
                    t-att-title="(isOrganizationSelected ? 'Hide ' : 'Show ') + props.organization.name + ' content.'"
                    tabindex="0"
                    class="border-end toggle_organization"
                    t-att-class="{'border-primary': isCurrent, 'disabled': !isOrganizationAllowed}"
                    t-on-click.stop="() => this.toggleOrganization()"
                >
                    <span class="btn border-0 p-2" t-att-class="isOrganizationAllowed ? 'btn-link text-primary' : 'disabled'">
                        <i class="fa fa-fw py-2" t-att-class="isOrganizationSelected ? 'fa-check-square text-primary' : 'fa-square-o'"/>
                    </span>
                </div>

                <div class="o_switcher_organization_item--logo">
                    <span t-esc="props.organization.initials"/>

                    <img
                        t-if="props.organization.logo_data"
                        t-att-src="props.organization.logo_data"
                        alt="Organization Logo"
                    />
                </div>

                <div
                    role="button"
                    t-att-aria-pressed="isCurrent ? 'true' : 'false'"
                    t-att-aria-label="'Switch to ' + props.organization.name "
                    t-att-title="'Switch to ' + props.organization.name "
                    tabindex="0"
                    class="d-flex flex-grow-1 align-items-center py-0 log_into ps-2"
                    t-on-click="() => this.logIntoOrganization()"
                >
                    <span
                        class='organization_label pe-3'
                        t-att-class="isCurrent ? 'text-900 fw-bold' : ''"
                    >
                        <t t-out="props.organization.name"/>
                    </span>
                </div>
            </div>
        </DropdownItem>
    </t>
</templates>
