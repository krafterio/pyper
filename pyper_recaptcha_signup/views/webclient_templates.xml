<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="signup" inherit_id="auth_signup.signup">
        <xpath expr="//button[@type='submit']" position="before">
            <t t-set="recaptcha_signup_enabled" t-value="env['ir.config_parameter'].sudo().get_param('pyper_recaptcha_signup.enabled')"/>

            <script t-if="recaptcha_signup_enabled"
                    type="text/javascript"
                    src="https://www.google.com/recaptcha/api.js"
            />

            <script t-if="recaptcha_signup_enabled">
                function onSubmitSignup(token) {
                    document.querySelector("form.oe_signup_form").submit();
                }
            </script>
        </xpath>

        <xpath expr="//button[@type='submit']" position="attributes">
            <attribute name="class" separator=" " add="g-recaptcha"/>
            <attribute name="t-att-data-sitekey">env['ir.config_parameter'].sudo().get_param('recaptcha_public_key')</attribute>
            <attribute name="data-callback">onSubmitSignup</attribute>
            <attribute name="data-action">signup_form</attribute>
        </xpath>
    </template>
</odoo>
