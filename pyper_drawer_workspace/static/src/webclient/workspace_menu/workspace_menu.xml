<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="pyper_drawer_workspace.WorkspaceMenu">
        <Dropdown class="'o_workspace_menu'" position="'bottom-start'">
            <t t-set-slot="toggler">
                <div class="o_avatar o_user_avatar">
                    <img
                        t-if="workspaceLogo"
                        t-att-src="workspaceLogo"
                        alt="Workspace Logo"
                    />

                    <span t-else="" t-out="workspaceInitials"/>
                </div>

                <div class="o_workspace_menu--infos">
                    <p class="o_workspace_menu--title mb-1 fw-bold lh-1" t-out="workspaceName"/>
                    <p class="o_workspace_menu--subtitle">Workspace</p>
                </div>

                <div class="o_workspace_menu--counter" t-if="globalCounter > 0">
                    <span class="badge text-white bg-primary rounded-pill" t-out="globalCounter"/>
                </div>

                <div class="o_workspace_menu--caret">
                    <i class="ph-light ph-caret-down"/>
                </div>
            </t>

            <div class="o_drawer--category" t-if="globalCounter > 0">
                <div class="o_drawer--category-label">
                    Workspace notifications
                </div>
            </div>

            <div class="o_workspace_menu--system-tray" t-if="globalCounter > 0">
                <t t-foreach="systemTrayItems" t-as="systemTrayItem" t-key="systemTrayItem.Component">
                    <t t-component="systemTrayItem.Component"/>
                </t>
            </div>

            <div class="o_drawer--category" t-if="allowedWorkspaces.length > 1">
                <div class="o_drawer--category-label">
                    Available workspaces
                </div>
            </div>

            <t t-foreach="allowedWorkspaces" t-as="workspace" t-key="workspace.id" t-if="allowedWorkspaces.length > 1">
                <WorkspaceMenuItem workspace="workspace" selector="props.selector"/>
            </t>

            <div class="o_drawer--category" t-if="menuItems.length > 0">
                <div class="o_drawer--category-label">
                    Workspace settings
                </div>
            </div>

            <WorkspaceSettingsItem t-foreach="menuItems"
                                   t-as="item"
                                   t-key="item.id"
                                   menu="item"
            />

            <t t-slot="default"/>
        </Dropdown>
    </t>

    <t t-name="pyper_drawer_workspace.WorkspaceSettingsItem">
        <DropdownItem
            class="{'o_workspace_menu--item': true}"
            parentClosingMode="'all'"
            dataset="{'menu': 'settings', 'setting-id': props.menu.id}"
            onSelected="() => this.onSelected()"
        >
            <div class="o_workspace_menu_item--avatar">
                <div t-if="props.menu.fontIcon" class="o_drawer--item-icon-empty" t-att-style="'color: ' + (props.menu.fontIconColor || 'inherit') + ';'">
                    <i t-att-class="props.menu.fontIcon"/>
                </div>

                <img t-elif="props.menu.iconData"
                    class="o_drawer--item-icon"
                    t-attf-src="data:image/jpeg;base64, {{props.menu.webIconData}}"
                />

                <div t-else="" class="o_drawer--item-icon-empty">
                    <t t-slot="empty_icon">
                        <i class="fa fa-cube"/>
                    </t>
                </div>
            </div>

            <div
                role="button"
                tabindex="0"
                class="d-flex flex-grow-1 align-items-center py-0 ps-2"
            >
                <span class='o_workspace_menu--title pe-3' t-out="props.menu.name"/>
            </div>
        </DropdownItem>
    </t>

    <t t-name="pyper_drawer_workspace.WorkspaceMenuItem">
        <DropdownItem
            class="{'o_workspace_menu--item': true, 'disabled': !isWorkspaceAllowed, 'workspace-active': isCurrent}"
            parentClosingMode="!isWorkspaceAllowed ? 'none' : 'all'"
            dataset="{'menu': 'workspace', 'workspace-id': props.workspace.id}"
        >
            <div
                role="menuitemcheckbox"
                t-if="props.selector"
                t-att-aria-checked="isWorkspaceSelected ? 'true' : 'false'"
                t-att-aria-label="props.workspace.name"
                t-att-title="(isWorkspaceSelected ? 'Hide ' : 'Show ') + props.workspace.name + ' content.'"
                tabindex="0"
                class="border-end o_workspace_menu_item--toggle"
                t-att-class="{'border-primary': isCurrent, 'disabled': !isWorkspaceAllowed}"
                t-on-click.stop="() => this.toggleWorkspace()"
            >
                <span class="btn border-0 px-2" t-att-class="isWorkspaceAllowed ? 'btn-link text-primary' : 'disabled'">
                    <i class="fa fa-fw" t-att-class="isWorkspaceSelected ? 'fa-check-square text-primary' : 'fa-square-o'"/>
                </span>
            </div>

            <div class="o_workspace_menu_item--avatar">
                <img
                    t-if="props.workspace.logo_data"
                    t-att-src="props.workspace.logo_data"
                    alt="Workspace Logo"
                />

                <span t-else="" t-out="props.workspace.initials"/>
            </div>

            <div
                role="button"
                t-att-aria-pressed="isCurrent ? 'true' : 'false'"
                t-att-aria-label="'Switch to ' + props.workspace.name "
                t-att-title="'Switch to ' + props.workspace.name "
                tabindex="0"
                class="d-flex flex-grow-1 align-items-center py-0 ps-2"
                t-on-click="() => this.logIntoWorkspace()"
            >
                <span
                    class='o_workspace_menu--title pe-3'
                    t-att-class="{'workspace-active': isCurrent}"
                >
                    <t t-out="props.workspace.name"/>
                </span>
            </div>
        </DropdownItem>
    </t>
</templates>
